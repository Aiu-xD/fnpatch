# Arkose Labs Proof of Work (PoW)

This document provides research and technical details on the Proof of Work (PoW) mechanism implemented by Arkose Labs (FunCaptcha), specifically focusing on the `tguess` component.

## Overview

Proof of Work in Arkose Labs is a client-side verification step designed to ensure that a challenge response was generated by a legitimate browser environment. It forces the client to execute a dynamic, obfuscated JavaScript payload before submitting an answer.

The primary artifact of this process is the `tguess` parameter included in the final challenge submission.

## Components

### 1. `dapib_url`
When a challenge session is initiated (via the `/fc/gfct` endpoint), the response contains a `dapib_url`. This URL points to a dynamic JavaScript file.
- **Uniqueness:** The script is unique to the session and expires quickly.
- **Rotation:** Thousands of variations are generated daily to prevent static analysis.
- **Function:** It contains the logic required to generate the `tguess` value.

### 2. `tguess` (Target Guess)
The `tguess` value is a cryptographically transformed version of the user's guess and session token. It is packaged in Arkose's standard encrypted format (`ct`, `iv`, `s`).

## The Verification Process

1. **Script Retrieval:** The client fetches the script from the `dapib_url`.
2. **Environment Execution:** The script is executed within the browser (usually in an iframe).
3. **Guess Transformation:** The script takes the session token and the guess index, performing complex string and mathematical transformations.
4. **Result Submission:** The resulting `tguess` object is encrypted and sent alongside the primary `guess` and biometric data (`bda`).

## Bot Detection & Anti-Sandboxing

Arkose includes several checks within the PoW script to detect automated environments (Node.js, JSDom, Headless Chrome).

### Common Checks
- **Process Detection:** `typeof process !== 'undefined'`
- **Visibility State:** Checking if the document is hidden or in a `prerender` state.
- **Browser APIs:** Verification of `requestAnimationFrame` and `cancelAnimationFrame`.
- **Global Objects:** Looking for `navigator.webdriver` or Selenium-specific properties.

### The "Trap" Mechanism
If a bot environment is detected, the script does not simply fail. Instead, it silently alters the output (e.g., appending a random character to the generated keys or values). This results in a `tguess` that looks valid but will be rejected by the Arkose server.

## Bypassing PoW

This project handles PoW by simulating the environment required by the `dapib` script.

### Strategies
- **Environment Emulation:** Providing a mock `window` and `document` object that satisfies the script's checks.
- **Script Sanitization:** Removing or patching the detection logic within the script before execution.
- **Post-Processing:** Identifying and stripping the "trap" characters from the final `tguess` output.

Refer to the implementation in `fnsolve/arkose_solve/scripts/tguess_gen/` for more details.
